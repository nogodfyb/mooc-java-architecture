# 数据库调优的维度

![](img\1.png)

## 业务需求

![](img\2.png)

![](img\3.png)

## 系统架构

![](img\4.png)

## SQL及索引

![](img\5.png)

## 表结构

![](img\6.png)

## 数据库参数设置

![](img\7.png)

## 系统配置

![](img\8.png)

## 硬件

![](img\9.png)

# 测试数据与工具

![](img\10.png)

https://dev.mysql.com/doc/index-other.html

## 导入数据

```shell
mysql -uroot -p123 < employees.sql
```

## 检测导入数据是否正确

```shell
mysql -uroot -p123 -t < test_employees_md5.sql
```

# 慢查询日志

![](img\11.png)

![](img\12.png)

## 相关参数

![](img\13.png)

## 使用方式

![](img\14.png)

开启日志

```sql
set global slow_query_log = 'on'
```

```sql
set global log_output = 'FILE,TABLE'
```

```sql
set global long_query_time = 0.001

show VARIABLES like '%long_query_time%'
```

```sql
set global log_queries_not_using_indexes = 'ON'
```

分析慢查询日志

```sql
select *,CONVERT(sql_text USING utf8 ) from mysql.slow_log
```

基于文件分析

```sql
show VARIABLES like '%slow_query_log_file%'
```



mysqldumpslow分析

# EXPLAIN

```
https://segmentfault.com/a/1190000008131735
```

# SQL性能分析

## navicat

![](img\15.png)

![](img\16.png)

# OPTIMIZER TRACE

# 数据库诊断命令

```sql
SHOW PROCESSLIST

SHOW STATUS

SHOW VARIABLES

SHOW TABLE STATUS

SHOW INDEX FROM employees

SHOW ENGINE INNODB status
```

# 索引

## B-TREE（B+TREE数据结构）

![](img\17.png)

![](img\18.png)

## HASH

![](img\19.png)

![](img\20.png)

## FULL TEXT

## 空间索引(R-Tree)

## 创建索引的原则

![](img\21.png)

![](img\22.png)

![](img\23.png)

![](img\24.png)

## 索引失效与解决方案

### 索引列不独立

独立是指:列不能是表达式的一部分，也不能是函数的参数

![](img\25.png)

![](img\26.png)

![](img\27.png)

![](img\28.png)

### 使用了左模糊

![](img\29.png)

### 使用OR查询的部分字段没有索引

### 字符串条件未使用‘ ’引起来

![](img\30.png)

![](img\31.png)

### 不符合最左前缀原则的查询

联合索引要符合最左前缀原则，否则会失效

### 索引字段建议添加NOT NULL约束

### 隐式转换导致索引失效

![](img\32.png)